<!DOCTYPE html>
<html>
	
<!-- Mirrored from bayou.io/draft/Comparing_Java_HTTP_Servers_Latencies.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Feb 2020 22:11:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
		<title>Comparing Java HTTP Servers' Latencies</title>
		<link rel="stylesheet" type="text/css" href="../site28f2.css?t-56be7398-0">
		<link rel="shortcut icon" type="image/x-icon" href="../favicon5323.ico?t-56be7384-0">
		<link rel="stylesheet" type="text/css" href="../deco5323.css?t-56be7384-0">
	</head>
	<body>
		<div id="header">
			<div id="logo">
				<a href="../index.html"><span id="logo1">bayou.io</span></a>
			</div>
			<div id="menu">
				<a href="../release/1.0/docs/index.html">Docs</a><a href="../code.html">Code</a><a href="../info.html">Info</a>
			</div>
		</div>
		<div id="bodyMain">
			<p>&gt; <a href="index.html">draft</a></p>

<h1>Comparing Java HTTP Servers' Latencies</h1>

<p><em>Zhong Yu, 2014-07-28</em></p>
<p>In this experiment, we try to measure differences in latencies among several Java HTTP servers running very simple HelloWorld applications. The result likely reflects how much work each server does in a basic request-response cycle.</p>
<p>First, our results, for the impatient:</p>
<pre>
    server         round-trip (ns)    latency diff (ns)
    ...................................................
    dummy             44,400             0,000
    undertow          52,600             8,200
    vert.x            55,900            11,500
    sun               58,100            13,700
    bayou             63,300            18,900
    jetty             78,100            33,700
    tomcat-bio        93,500            49,100
    tomcat-nio        95,200            50,800
</pre>

<h2 id=Test_Method><a href=#Test_Method>Test Method</a></h2>

<p>The test machine is an Amazon EC2 <code>m3.xlarge</code> instance with 4 CPUs, running 64bit Amazon Linux AMI. Don't let the name fool you, <code>m3.xlarge</code> is a very modest hardware. We use Amazon so that the test setup can be easily replicated by others.</p>
<p>We test the servers one at a time; for each server, we run ApacheBench on the same machine to establish a <em>single</em> keep-alive connection that sends 10 million requests to the server:</p>
<pre>
    ab -k -c1 -n10000000 http://localhost:8080/
</pre>
<p>There is no concurrency; the communication is strictly half-duplex; both ApacheBench and the server have one thread dedicated to the connection; the two threads are likely pinned to two separate CPUs most of the time. The average round trip time for a request-response cycle would a sum of</p>
<ul>
  <li>the time ApacheBench spends on the request/response,</li>
  <li>the time the TCP stack (local loopback) spends,</li>
  <li>the time the server spends on the request/response.</li>
</ul>
<p>We postulate that the first two items are constant, therefore the differences in the round trip time reflect the differences in the 3rd item, i.e. how much time each server spends on the request-response cycle.</p>

<h2 id=Tested_Servers><a href=#Tested_Servers>Tested Servers</a></h2>

<p>The following servers are tested:</p>
<ul>
  <li>
  <p><a href="https://github.com/zhong-j-yu/latency-diff/blob/master/src/dummy/DummyServer.java">dummy</a>, a phony server that does almost nothing. It's probably as far as we can get in Java. We use it as a baseline in comparisons; Though it is not a legitimate HTTP server, it'll fool ApacheBench in this simple experiment.</p></li>
  <li>
  <p><a href="http://undertow.io/">undertow</a>, version <code>1.0.15</code>.</p></li>
  <li>
  <p><a href="http://vertx.io/">vert.x</a>, version <code>2.1.2</code>.</p></li>
  <li>
  <p><a href="http://docs.oracle.com/javase/8/docs/jre/api/net/httpserver/spec/com/sun/net/httpserver/package-summary.html">sun</a> - <code>com.sun.net.httpserver.HttpServer</code> shipped with the JDK.</p></li>
  <li>
  <p><a href="../index.html">bayou</a>, version <code>0.9.4</code>. <br> <em>Note: the author of this article is also the author of bayou.</em></p></li>
  <li>
  <p><a href="http://www.eclipse.org/jetty/">jetty</a>, version <code>9.2.1.v20140609</code>.</p></li>
  <li>
  <p><a href="http://tomcat.apache.org/">tomcat</a>, version <code>8.0.9</code>. Both BIO (blocking IO) and NIO options are tested. In <code>conf/server.xml</code>, <code>maxKeepAliveRequests=&quot;10000000&quot;</code> is added to <code>&lt;Connector&gt;</code>, and access log is disabled,</p></li>
</ul>
<p>The test sources and dependent libraries can be found on <a href="https://github.com/zhong-j-yu/latency-diff">https://github.com/zhong-j-yu/latency-diff</a>. We create a HelloWorld app on each server that responds with a 10-byte "HelloWorld" text/plain message to any request. To be fair, responses generated by all servers should be about the same size, containing same amount of headers, as the following example</p>
<pre>
    HTTP/1.1 200 OK
    Accept-Ranges: bytes
    Content-Type: text/plain;charset=UTF-8
    ETag: &quot;t-53d5df40-18519600&quot;
    Last-Modified: Mon, 28 Jul 2014 05:27:28 GMT
    Cache-Control: private, no-cache
    Content-Length: 10
    Connection: keep-alive
    Date: Mon, 28 Jul 2014 05:27:28 GMT
    Server: Bayou

    HelloWorld
</pre>
<p>All servers run on JDK 8 u20 b23 (<a href="http://www.oracle.com/splash/java.net/index.html">link to tar.gz</a>) with default JVM settings.</p>

<h2 id=Results><a href=#Results>Results</a></h2>

<p>As previously mentioned, we run the HelloWorld app of each server, use ApacheBench to send 10 million requests over a single keep-alive connection. The average requests/second measured:</p>
<pre>
                 requests/second
    dummy           22,500
    undertow        19,000
    vert.x          17,900
    sun             17,200
    bayou           15,800
    jetty           12,800
    tomcat-bio      10,700
    tomcat-nio      10,500
</pre>
<p>The inverse, ns/request, is the round trip time for a request-response cycle</p>
<pre>
                  round-trip (ns)
    dummy           44,400
    undertow        52,600
    vert.x          55,900
    sun             58,100
    bayou           63,300
    jetty           78,100
    tomcat-bio      93,500
    tomcat-nio      95,200
</pre>
<p>We are interested in how much time each server spends on its own code. Since the code of the dummy server does almost nothing, we use it as the baseline for comparisons, by subtracting dummy's number from others</p>
<pre>
                  latency diff (ns)
    dummy            0,000
    undertow         8,200
    vert.x          11,500
    sun             13,700
    bayou           18,900
    jetty           33,700
    tomcat-bio      49,100
    tomcat-nio      50,800
</pre>
<p>The remaining numbers likely reflect how much work each server does for the request-response cycle. Part of the differences may be due to the amount of features and abstractions that different servers have to support.</p>

<h2 id=Does_it_matter?><a href=#Does_it_matter?>Does it matter?</a></h2>

<p>We see that the last place finisher, <code>tomcat-nio</code>, adds only <code>0.05 ms</code> to the latency compared to the dummy server. Very few applications need to worry about a per-request overhead at that level.</p>
<p>Any of the Java servers listed here is probably way faster than you'll actually care.</p>

<h2 id=Disclaimer><a href=#Disclaimer>Disclaimer</a></h2>

<p>The author of this article has an obvious conflict of interest.</p>
<p>The benchmark numbers are measured in a very specific environment for a very specific purpose. It's risky to extrapolate the numbers for other situations and purposes.</p>
<p><em>Contact: <a href="mailto:&#98;a&#121;&#x6f;&#x75;&#x2d;&#x69;&#111;&#x40;&#x67;o&#111;&#x67;&#108;e&#103;&#114;&#111;u&#112;s&#x2e;&#99;&#x6f;&#x6d;">&#98;a&#121;&#x6f;&#x75;&#x2d;&#x69;&#111;&#x40;&#x67;o&#111;&#x67;&#108;e&#103;&#114;&#111;u&#112;s&#x2e;&#99;&#x6f;&#x6d;</a></em></p>
		</div>
		<div id="footer">
			bayou.io
		</div>
	</body>

<!-- Mirrored from bayou.io/draft/Comparing_Java_HTTP_Servers_Latencies.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 28 Feb 2020 22:11:47 GMT -->
</html>